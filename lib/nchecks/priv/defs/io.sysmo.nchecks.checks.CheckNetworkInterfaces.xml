<?xml version="1.0" encoding="UTF-8"?>
<NChecks xmlns="http://schemas.sysmo.io/2015/NChecks">
    <Check
        Id="CheckNetworkInterfaces"
        AttribUrl="www.sysmo.io"
        UpdatesUrl="www.sysmo.io/nchecks/updates/CheckNetworkInterfaces/"
        Type="snmp"
        Class="io.sysmo.nchecks.checks.CheckNetworkInterfaces" >
        <Author><![CDATA[Sebastien Serre <ssbx@sysmo.io>]]></Author>
        <Description>Monitor and log interfaces performances values</Description>
        <HelperTable>
            <Helper
                Id="SelectNetworkInterfaces"
                Type="snmp"
                Return="table"
                AutoStart="true"
                Class="io.sysmo.nchecks.helpers.HelperNetworkInterfaces" >
                <!--
                "io.sysmo.nchecks.CheckNetworkInterfaces" should return a json object like:
                {
                    "name": "SelectNetworkInterfaces",
                    "rows": [
                        {"ifType": "9", "ifDescr": "fa0/0", "ifIndex": "0", "ifPhysAddress": "aa"}
                    ]
                }
                -->
                <Description>This helper offer a list view of the target device interfaces</Description>
                <HelperTableReturn
                    TreeRoot="ifType"
                    Select="ifIndex"
                    Sort="ifDescr"
                    SelectionType="multiple"
                    FillFlag="if_selection">
                    <ListSeparator>,</ListSeparator>
                    <Usage>Please select interfaces you want to monitor from the list.</Usage>
                    <Column Id="ifDescr"        Position="0" Type="string" />
                    <Column Id="ifIndex"        Position="1" Type="string" />
                    <Column Id="ifPhysAddress"  Position="2" Type="string" />
                </HelperTableReturn>
            </Helper>
        </HelperTable>
        <FlagTable>
            <Flag
                Id="if_selection"
                Role="mandatory"
                Type="string"
                HelperButton="SelectNetworkInterfaces" >
                <Default></Default>
                <Hint>If indexes list</Hint>
                <Usage>Comma separated list of integers representing snmp interface indexes</Usage>
            </Flag>
        </FlagTable>
        <Performances Type="table">
            <FlagSource Name="if_selection"/>
            <FlagSeparator>,</FlagSeparator>

            <FilePrefix>ifIndex</FilePrefix>
            <FileSuffix>.rrd</FileSuffix>

            <PropertyPrefix>ifIndex</PropertyPrefix>
            <PropertySuffix>-ifName</PropertySuffix>

            <!-- PropertyPrefix PropertySuffix
            if present, the client will take the
            ${prefix="ifIndex"}${"if_selection[x]"}${suffix=""} from the target -->
            <DataSourceTable>
                <DataSource Id="IfInOctets"       Type="COUNTER" />
                <DataSource Id="IfInUcastPkts"    Type="COUNTER" />
                <DataSource Id="IfInNucastPkts"   Type="COUNTER" />
                <DataSource Id="IfInErrors"       Type="COUNTER" />
                <DataSource Id="IfOutOctets"      Type="COUNTER" />
                <DataSource Id="IfOutUcastPkts"   Type="COUNTER" />
                <DataSource Id="IfOutNucastPkts"  Type="COUNTER" />
                <DataSource Id="IfOutErrors"      Type="COUNTER" />
            </DataSourceTable>
            <GraphTable>
                <Graph
                    Id="OctetsInOut"
                    Minimum="0"
                    Maximum="undefined"
                    Rigid="false"
                    Base="1000"
                    Unit=""
                    UnitExponent="0" >
                    <Title>Octets In/Out</Title>
                    <VerticalLabel>octets</VerticalLabel>
                    <Draw
                        Type="area"
                        DataSource="IfInOctets"
                        Consolidation="MAX"
                        Color="#726fcfff" >
                        Octets in
                    </Draw>
    
                     <Draw
                        Type="line"
                        DataSource="IfOutOctets"
                        Consolidation="MAX"
                        Color="#73d216ff" >
                        Octets out
                    </Draw>
                </Graph>
                <Graph
                    Id="UnicastNonUnicast"
                    Minimum="0"
                    Maximum="undefined"
                    Rigid="false"
                    Base="1000"
                    Unit=""
                    UnitExponent="0" >
                    <Title>Unicast/Non Unicast Packets In/Out</Title>
                    <VerticalLabel>packets</VerticalLabel>
                    <Draw
                        Type="area"
                        DataSource="IfInUcastPkts"
                        Consolidation="MAX"
                        Color="#3465a4ff" >
                        Unicast packets In
                    </Draw>
                    <Draw
                        Type="area"
                        DataSource="IfInNucastPkts"
                        Consolidation="MAX"
                        Color="#4e9a06ff" >
                        Non Unicast Packets In
                    </Draw>
                    <Draw
                        Type="line"
                        DataSource="IfOutUcastPkts"
                        Consolidation="MAX"
                        Color="#c17d11ff" >
                        Unicast packets Out
                    </Draw>
                    <Draw
                        Type="line"
                        DataSource="IfOutNucastPkts"
                        Consolidation="MAX"
                        Color="#e9b96eff" >
                        Non Unicast packets Out
                    </Draw>
                </Graph>
                <Graph
                    Id="ErrorsInOut"
                    Minimum="0"
                    Maximum="undefined"
                    Rigid="false"
                    Base="1000"
                    Unit=""
                    UnitExponent="0" >
                    <Title>Errors In/Out</Title>
                    <VerticalLabel>Errors</VerticalLabel>
                    <Draw
                        Type="line"
                        DataSource="IfInErrors"
                        Consolidation="MAX"
                        Color="#cc0000ff" >
                        Octets in
                    </Draw>
    
                     <Draw
                        Type="line"
                        DataSource="IfOutErrors"
                        Consolidation="MAX"
                        Color="#fce94fff" >
                        Octets out
                    </Draw>
                </Graph>
            </GraphTable>
        </Performances>
    </Check>
</NChecks>
