<?xml version="1.0" encoding="UTF-8"?>
<NChecks xmlns="http://schemas.sysmo.io/2015/NChecks">
    <Check
        Id="CheckTCP"
        AttribUrl="www.sysmo.io"
        UpdatesUrl="www.sysmo.io/nchecks/updates/CheckTCP/"
        Type="simple"
        Descr="Check TCP service availability on the specified host"
        Class="io.sysmo.nchecks.CheckTCP" >
        <Author><![CDATA[Sebastien Serre <ssbx@sysmo.io>]]></Author>
        <FlagTable>
            <Flag
                Id="host"
                AutoFill="host"
                Default=""
                Role="mandatory"
                Type="string"
                Hint="Hostname or IP" >
                Host target as ip version 4/6 or hostname
            </Flag>
            <Flag
                Id="port"
                Minimum="1"
                Maximum="65535"
                Default="8080"
                Role="mandatory"
                Type="integer"
                Hint="IP protocol port" >
                TCP port number to query
            </Flag>
            <Flag
                Id="ms_warning"
                Minimum="0"
                Maximum="60000"
                Default="500"
                Role="mandatory"
                Type="integer"
                Hint="Milliseconds" >
                If connection time exceed the value, set the return status to WARNING.
            </Flag>
            <Flag
                Id="ms_critical"
                Role="mandatory"
                Minimum="0"
                Maximum="60000"
                Default="2500"
                Type="integer"
                Hint="Milliseconds" >
                If connection time exceed the value, set the return status to CRITICAL.
            </Flag>
            <Flag
                Id="ms_timeout"
                Minimum="0"
                Maximum="60000"
                Default="5000"
                Role="mandatory"
                Type="integer"
                Hint="Milliseconds" >
                Abort connection if it exceed the value.
            </Flag>
            <Flag
                Id="accept"
                Default="OK"
                Role="mandatory"
                Type="string"
                Hint="CRITICAL | WARNING | OK" >
                If the connexion succeed, set the return status to one of CRITICAL|WARNING|OK. OK is the default behaviour. If set to something other than OK, ms_warning and ms_critical are ignored. Usefull if we want the service monitored to be down, and to be alerted when it comes up.
            </Flag>
        </FlagTable>
        <Performances Type="simple" FileName="CheckTCP.rrd">
            <DataSourceTable>
                <DataSource Id="ReplyDuration" Type="GAUGE" />
            </DataSourceTable>
            <GraphTable>
                <Graph
                    Id="TCPLatency"
                    Title="TCP Performances"
                    VerticalLabel="Milliseconds"
                    Minimum="0"
                    Maximum="undefined"
                    Rigid="false"
                    Base="1000"
                    Unit="ms"
                    UnitExponent="0" >
                    <Draw
                        Type="line"
                        DataSource="ReplyDuration"
                        Legend="Maximum reply latency"
                        Consolidation="MAX"
                        Color="#729FCFFF" />
                    <Draw
                        Type="line"
                        DataSource="ReplyDuration"
                        Legend="Average reply latency"
                        Consolidation="MAX"
                        Color="#204A87FF" />
                    <Draw
                        Type="line"
                        DataSource="ReplyDuration"
                        Legend="Minimum reply latency"
                        Consolidation="MAX"
                        Color="#3665A4FF" />
                </Graph>
            </GraphTable>
        </Performances>
    </Check>
</NChecks>
