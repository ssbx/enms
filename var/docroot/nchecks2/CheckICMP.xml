<?xml version="1.0" encoding="UTF-8"?>
<NChecks xmlns="http://schemas.sysmo.io/2015/NChecks">
    <Check
        Id="CheckICMP"
        Type="simple"
        Descr="Check host presence using ICMP echo request"
        Class="io.sysmo.nchecks.CheckICMP" >
        <FlagTable>
            <Flag
                Id="host"
                Usage="Host target as ip version 4/6 or hostname"
                AutoFill="host"
                Editable="true"
                Default=""
                Role="mandatory"
                Type="string"
                Hint="Host or IP" />
            <Flag
                Id="pkts_number"
                Usage="Number of packets to send"
                Min="1"
                Max="50"
                Default="5"
                Role="mandatory"
                Type="integer"
                Hint="packets number" />
            <Flag
                Id="pkts_size"
                Usage="Size of the ICMP body in octets"
                Min="56"
                Max="512"
                Default="56"
                Role="mandatory"
                Type="integer"
                Hint="Octets" />
            <Flag
                Id="pl_warning"
                Usage="Packet lost CRITICAL threshold in percent. Will return a status WARNING when packet lost exceed the value"
                Min="0"
                Max="99"
                Default="50"
                Role="mandatory"
                Type="integer"
                Hint="Milliseconds" />
            <Flag
                Id="pl_critical"
                Usage="Packet lost CRITICAL threshold in percent. Will return a status CRITICAL when packet lost exceed the value"
                Min="0"
                Max="99"
                Default="99"
                Role="mandatory"
                Type="integer"
                Hint="Milliseconds" />
            <Flag
                Id="ms_warning"
                Usage="Echo/Reply latency WARNING threshold. Will return a status WARNING if average reply time exceed the value"
                Min="0"
                Max="60000"
                Default="200"
                Role="mandatory"
                Type="integer"
                Hint="Milliseconds" />
            <Flag
                Id="ms_critical"
                Usage="Echo/Reply latency CRITICAL threshold. Will return a status CRITICAL if average reply time exceed the value"
                Min="0"
                Max="60000"
                Default="200"
                Role="mandatory"
                Type="integer"
                Hint="Milliseconds" />
            <Flag
                Id="ms_timeout"
                Usage="Stop waiting reply or refuse reply when it exceed the value"
                Min="0"
                Max="20000"
                Default="5000"
                Role="mandatory"
                Type="integer"
                Hint="Milliseconds" />
            <Flag
                Id="ms_interval"
                Usage="Interval in milliseconds between request packets"
                Min="1"
                Max="500"
                Default="100"
                Role="mandatory"
                Type="integer"
                Hint="Milliseconds" />
            <Flag
                Id="use_ipv6"
                Usage="Force use of the v6 address. Usefull if host arg is an hostname"
                Default="false"
                Type="boolean"
                Hint=""
                Role="mandatory" />
        </FlagTable>
        <Performances Type="simple">
            <DataSourceTable>
                <DataSource Id="MinRoundTrip"       Type="GAUGE" />
                <DataSource Id="MaxRoundTrip"       Type="GAUGE" />
                <DataSource Id="AverageRoundTrip"   Type="GAUGE" />
                <DataSource Id="PercentLost"        Type="GAUGE" />
            </DataSourceTable>
            <GraphTable>
                <Graph
                    Id="ICMPPerfs"
                    Title="ICMP Performances"
                    VerticalLabel="Milliseconds"
                    Min="0"
                    Max="undefined"
                    Rigid="false"
                    Base="1000"
                    Unit="ms"
                    UnitExponent="0" >
                    <Draw
                        Type="area"
                        DataSource="MaxRoundTrip"
                        Legend="Max round trip"
                        Consolidation="MAX"
                        Color="#204A87AA" />
                    <Draw
                        Type="area"
                        DataSource="MinRoundTrip"
                        Legend="Min round trip"
                        Consolidation="MAX"
                        Color="#20ff87AA" />
                    <Draw
                        Type="area"
                        DataSource="AverageRoundTrip"
                        Legend="Average round trip"
                        Consolidation="MAX"
                        Color="#ff4A87AA" />
                </Graph>
                <Graph
                    Id="ICMPPercentsLost"
                    Title="ICMP replies lost"
                    VerticalLabel="Percent"
                    Min="0"
                    Max="100"
                    Rigid="true"
                    Base="1000"
                    Unit="%"
                    UnitExponent="0" >
                    <Draw
                        Type="area"
                        DataSource="PercentLost"
                        Legend="Maximum Percent packets lost"
                        Consolidation="MAX"
                        Color="#AD7FA8FF" />
                    
                    <Draw
                        Type="area"
                        DataSource="PercentLost"
                        Legend="Average Percent Packets Lost"
                        Consolidation="AVERAGE"
                        Color="#5C3566FF" />
                </Graph>
            </GraphTable>
        </Performances>
    </Check>
</NChecks>
